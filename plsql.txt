CREATE TABLE MediaItems(
    MID NUMBER(9,0) PRIMARY KEY,
    TITLE VARCHAR2(200),
    PROD_YEAR NUMBER(4),
    TITLE_LENGTH NUMBER(4)
    );
    
CREATE TABLE Similarity(
    MID1 NUMBER(9,0),
    MID2 NUMBER(9,0),
    SIMILARITY FLOAT,
    CONSTRAINT FK_MID1MID FOREIGN KEY (MID1) REFERENCES MediaItems(MID),
    CONSTRAINT FK_MID2MID FOREIGN KEY (MID2) REFERENCES MediaItems(MID),
    CONSTRAINT PK_Similarity PRIMARY KEY (MID1, MID2)
);

CREATE or REPLACE TRIGGER AutoIncrement
BEFORE INSERT ON MediaItems 
FOR EACH ROW
DECLARE
	maxMid NUMBER;
BEGIN
	:new.TITLE_LENGTH:=LENGTH(:new.TITLE);

	SELECT MAX(MID) INTO maxMid FROM MediaItems;
	IF maxMid IS NULL THEN
        :new.MID:= 0;
	ELSE
        :new.MID:= maxMid + 1;
	END IF;
END;

create or replace FUNCTION MaximalDistance
Return NUMBER is 
    minYear NUMBER;
    maxYear NUMBER;

BEGIN
 SELECT MIN(PROD_YEAR) INTO minYear
 FROM MEDIAITEMS;
 SELECT MAX(PROD_YEAR) INTO maxYear
 FROM MEDIAITEMS;
 RETURN POWER(maxYear - minYear, 2);
END;

